# RE WP python2

实属惭愧，z3还是没用上，用技巧得到了flag

反编译pyc并加以修改得到python3代码

```python
import struct

def fun(start, end, s):
    a = 32310901
    b = 1729
    c = s
    m = end - start
    while True:
        d = int((a * c + b) % m)
        yield d
        c = d

if __name__ == '__main__':
    arr = [
        77, 263, 394, 442, 463, 512, 667, 641, 804, 752, 885, 815, 1075, 1059, 1166, 1082, 1429, 1583, 1696, 1380,
        1987, 2263, 2128, 2277, 2387, 2670, 2692, 3255, 3116, 3306, 3132, 3659, 3139, 3422, 3600, 3584, 3343, 3546,
        3299, 3633, 3281, 3146, 2990, 2617, 2780, 2893, 2573, 2584, 2424, 2715, 2513, 2324, 2080, 2293, 2245, 2309,
        2036, 1944, 1931, 1817, 1483, 1372, 1087, 1221, 893, 785, 697, 586, 547, 324, 177, 184]
    flag = input('plz input your flag:')
    length = len(flag)
    a = struct.unpack('<I', flag[length - 4:].encode())[0] & 255 #其实是倒数第4个字母，vscode上会出现raw_input读取flag的时候会在结尾加上一个'\r'的情况
    b = []
    c = fun(1, 255, a)
    for i in range(32):
        b.append(next(c))

    d = [0] * 72
    for i in range(length):
        for j in range(32):
            a = ord(flag[i]) ^ b[j]
            d[(i + j)] += a

    for i in range(len(d)):
        if d[i] != arr[i]:
            print('fail')
            exit(0)

    print('success')
    exit(0)

```

我的取巧的做法是，先猜测flag长度，易猜flag长度为`72 - 32`（这样才会填满`d`，当然，不能完全肯定，因为arr后面也可能放入假的数据，这样也不会影响对`d`和`arr`的比较）

然后猜测倒数第4个字符是什么，flag格式为`Syc{xxxx}`，而`arr[0] == ord('S') ^ b[0]`。易推出这个字符是`1`，然后用`fun()`生成`b`数组。

```python
b = []

def fun(s):
    a = 32310901
    b = 1729
    c = s
    m = 255 - 1
    while True:
    tmp = (a * c + b) % m
    yield tmp
    c = tmp

c = fun(ord('1'))
for i in range(72 - 32):
    b.append(next(c))
```

然后就有以下解密脚本：

```python
arr = [77, 263, 394, 442, 463, 512, 667, 641, 804, 752, 885, 815, 1075, 1059, 1166, 1082, 1429, 1583, 1696, 1380,
       1987, 2263, 2128, 2277, 2387, 2670, 2692, 3255, 3116, 3306, 3132, 3659, 3139, 3422, 3600, 3584, 3343, 3546,
       3299, 3633, 3281, 3146, 2990, 2617, 2780, 2893, 2573, 2584, 2424, 2715, 2513, 2324, 2080, 2293, 2245, 2309,
       2036, 1944, 1931, 1817, 1483, 1372, 1087, 1221, 893, 785, 697, 586, 547, 324, 177, 184]

b = [30, 243, 208, 79, 68, 71, 24, 83, 90, 65, 118, 219, 76, 115, 12, 17, 108, 37, 218, 7, 180,
     179, 110, 175, 88, 181, 248, 45, 8, 249, 114, 197, 82, 21, 130, 31, 58, 143, 166, 229]
d = [0] * 72


def fill(start, char):
    for i in range(32):
        d[i + start] += char ^ b[i]


flag = ''
for i in range(72 - 32):
    c = (arr[i] - d[i]) ^ b[0]
    flag += chr(c)
    fill(i, c)

print(flag+'}')
```

得到flag:

`Syc{Y0u_S3e_Z3_1s_soooo00000_Interest1ng}`

